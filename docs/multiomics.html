<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 多组学分析 | R cookbook from Xiaotao Shen</title>
  <meta name="description" content="记录所有跟R语言有关的内容" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 多组学分析 | R cookbook from Xiaotao Shen" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="记录所有跟R语言有关的内容" />
  <meta name="github-repo" content="jaspershen/r_cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 多组学分析 | R cookbook from Xiaotao Shen" />
  
  <meta name="twitter:description" content="记录所有跟R语言有关的内容" />
  

<meta name="author" content="  Dr. Xiaotao Shen   Postdoctoral at Snyder lab   Stanford University School of Medicine      shenxt.info    shenxt@stanford.edu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="network.html"/>
<link rel="next" href="regularexpression.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.12/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R cookbook of Xiaotao Shen</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>1</b> Markdown</a><ul>
<li class="chapter" data-level="1.1" data-path="markdown.html"><a href="markdown.html#markdown语法"><i class="fa fa-check"></i><b>1.1</b> Markdown语法</a></li>
<li class="chapter" data-level="1.2" data-path="markdown.html"><a href="markdown.html#标题-header"><i class="fa fa-check"></i><b>1.2</b> 标题 (Header)</a></li>
<li class="chapter" data-level="1.3" data-path="markdown.html"><a href="markdown.html#图片-image"><i class="fa fa-check"></i><b>1.3</b> 图片 (Image)</a></li>
<li class="chapter" data-level="1.4" data-path="markdown.html"><a href="markdown.html#链接-links"><i class="fa fa-check"></i><b>1.4</b> 链接 (Links)</a></li>
<li class="chapter" data-level="1.5" data-path="markdown.html"><a href="markdown.html#强调-emphasize"><i class="fa fa-check"></i><b>1.5</b> 强调 (Emphasize)</a></li>
<li class="chapter" data-level="1.6" data-path="markdown.html"><a href="markdown.html#引用blockquotes"><i class="fa fa-check"></i><b>1.6</b> 引用(Blockquotes)</a></li>
<li class="chapter" data-level="1.7" data-path="markdown.html"><a href="markdown.html#代码块-code-chunks"><i class="fa fa-check"></i><b>1.7</b> 代码块 (Code chunks)</a></li>
<li class="chapter" data-level="1.8" data-path="markdown.html"><a href="markdown.html#水平线-horizontal-rule"><i class="fa fa-check"></i><b>1.8</b> 水平线 (Horizontal rule)</a></li>
<li class="chapter" data-level="1.9" data-path="markdown.html"><a href="markdown.html#列表-list"><i class="fa fa-check"></i><b>1.9</b> 列表 (List)</a></li>
<li class="chapter" data-level="1.10" data-path="markdown.html"><a href="markdown.html#表格-tables"><i class="fa fa-check"></i><b>1.10</b> 表格 (Tables)</a></li>
<li class="chapter" data-level="1.11" data-path="markdown.html"><a href="markdown.html#段落"><i class="fa fa-check"></i><b>1.11</b> 段落</a></li>
<li class="chapter" data-level="1.12" data-path="markdown.html"><a href="markdown.html#插入icon"><i class="fa fa-check"></i><b>1.12</b> 插入icon</a></li>
<li class="chapter" data-level="1.13" data-path="markdown.html"><a href="markdown.html#数学公式-equations"><i class="fa fa-check"></i><b>1.13</b> 数学公式 (Equations)</a><ul>
<li class="chapter" data-level="1.13.1" data-path="markdown.html"><a href="markdown.html#行内和行外"><i class="fa fa-check"></i><b>1.13.1</b> 行内和行外</a></li>
<li class="chapter" data-level="1.13.2" data-path="markdown.html"><a href="markdown.html#上标和下标"><i class="fa fa-check"></i><b>1.13.2</b> 上标和下标</a></li>
<li class="chapter" data-level="1.13.3" data-path="markdown.html"><a href="markdown.html#占位符"><i class="fa fa-check"></i><b>1.13.3</b> 占位符</a></li>
<li class="chapter" data-level="1.13.4" data-path="markdown.html"><a href="markdown.html#四则运算"><i class="fa fa-check"></i><b>1.13.4</b> 四则运算</a></li>
<li class="chapter" data-level="1.13.5" data-path="markdown.html"><a href="markdown.html#集合运算"><i class="fa fa-check"></i><b>1.13.5</b> 集合运算</a></li>
<li class="chapter" data-level="1.13.6" data-path="markdown.html"><a href="markdown.html#数学符号"><i class="fa fa-check"></i><b>1.13.6</b> 数学符号</a></li>
<li class="chapter" data-level="1.13.7" data-path="markdown.html"><a href="markdown.html#希腊字母"><i class="fa fa-check"></i><b>1.13.7</b> 希腊字母</a></li>
</ul></li>
<li class="chapter" data-level="1.14" data-path="markdown.html"><a href="markdown.html#视频-video和音乐-music"><i class="fa fa-check"></i><b>1.14</b> 视频 (Video)和音乐 (music)</a></li>
<li class="chapter" data-level="1.15" data-path="markdown.html"><a href="markdown.html#markdown编辑器"><i class="fa fa-check"></i><b>1.15</b> Markdown编辑器</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>2</b> Rmarkdown</a><ul>
<li class="chapter" data-level="2.1" data-path="rmarkdown.html"><a href="rmarkdown.html#安装"><i class="fa fa-check"></i><b>2.1</b> 安装</a></li>
<li class="chapter" data-level="2.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown结构"><i class="fa fa-check"></i><b>2.2</b> Rmarkdown结构</a></li>
<li class="chapter" data-level="2.3" data-path="rmarkdown.html"><a href="rmarkdown.html#yaml"><i class="fa fa-check"></i><b>2.3</b> YAML</a></li>
<li class="chapter" data-level="2.4" data-path="rmarkdown.html"><a href="rmarkdown.html#r代码块"><i class="fa fa-check"></i><b>2.4</b> R代码块</a></li>
<li class="chapter" data-level="2.5" data-path="rmarkdown.html"><a href="rmarkdown.html#代码块参数-chunk-options"><i class="fa fa-check"></i><b>2.5</b> 代码块参数 (Chunk options)</a><ul>
<li class="chapter" data-level="2.5.1" data-path="rmarkdown.html"><a href="rmarkdown.html#代码是否执行"><i class="fa fa-check"></i><b>2.5.1</b> 代码是否执行</a></li>
<li class="chapter" data-level="2.5.2" data-path="rmarkdown.html"><a href="rmarkdown.html#代码控制-code-decoration"><i class="fa fa-check"></i><b>2.5.2</b> 代码控制 (code decoration)</a></li>
<li class="chapter" data-level="2.5.3" data-path="rmarkdown.html"><a href="rmarkdown.html#缓冲-cache"><i class="fa fa-check"></i><b>2.5.3</b> 缓冲 (cache)</a></li>
<li class="chapter" data-level="2.5.4" data-path="rmarkdown.html"><a href="rmarkdown.html#图像控制plot"><i class="fa fa-check"></i><b>2.5.4</b> 图像控制(plot)</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="rmarkdown.html"><a href="rmarkdown.html#全局代码块参数"><i class="fa fa-check"></i><b>2.6</b> 全局代码块参数</a></li>
<li class="chapter" data-level="2.7" data-path="rmarkdown.html"><a href="rmarkdown.html#具体问题的cookbook"><i class="fa fa-check"></i><b>2.7</b> 具体问题的cookbook</a></li>
<li class="chapter" data-level="2.8" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown特有语法"><i class="fa fa-check"></i><b>2.8</b> Rmarkdown特有语法</a><ul>
<li class="chapter" data-level="2.8.1" data-path="rmarkdown.html"><a href="rmarkdown.html#图片-image-1"><i class="fa fa-check"></i><b>2.8.1</b> 图片 (image)</a></li>
<li class="chapter" data-level="2.8.2" data-path="rmarkdown.html"><a href="rmarkdown.html#表格-table"><i class="fa fa-check"></i><b>2.8.2</b> 表格 (Table)</a></li>
<li class="chapter" data-level="2.8.3" data-path="rmarkdown.html"><a href="rmarkdown.html#地图-map"><i class="fa fa-check"></i><b>2.8.3</b> 地图 (map)</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="rmarkdown.html"><a href="rmarkdown.html#输出格式"><i class="fa fa-check"></i><b>2.9</b> 输出格式</a><ul>
<li class="chapter" data-level="2.9.1" data-path="rmarkdown.html"><a href="rmarkdown.html#html格式"><i class="fa fa-check"></i><b>2.9.1</b> HTML格式</a></li>
<li class="chapter" data-level="2.9.2" data-path="rmarkdown.html"><a href="rmarkdown.html#pdf格式"><i class="fa fa-check"></i><b>2.9.2</b> PDF格式</a></li>
<li class="chapter" data-level="2.9.3" data-path="rmarkdown.html"><a href="rmarkdown.html#word格式"><i class="fa fa-check"></i><b>2.9.3</b> Word格式</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html"><i class="fa fa-check"></i><b>3</b> Rmarkdown拓展</a><ul>
<li class="chapter" data-level="3.1" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#blogdown"><i class="fa fa-check"></i><b>3.1</b> Blogdown</a><ul>
<li class="chapter" data-level="3.1.1" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#需要准备的东西"><i class="fa fa-check"></i><b>3.1.1</b> 需要准备的东西</a></li>
<li class="chapter" data-level="3.1.2" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#安装-1"><i class="fa fa-check"></i><b>3.1.2</b> 安装</a></li>
<li class="chapter" data-level="3.1.3" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#创建项目"><i class="fa fa-check"></i><b>3.1.3</b> 创建项目</a></li>
<li class="chapter" data-level="3.1.4" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#预览"><i class="fa fa-check"></i><b>3.1.4</b> 预览</a></li>
<li class="chapter" data-level="3.1.5" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#使用rstudio-ide来管理网站"><i class="fa fa-check"></i><b>3.1.5</b> 使用Rstudio IDE来管理网站</a></li>
<li class="chapter" data-level="3.1.6" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#更改为其他的主题"><i class="fa fa-check"></i><b>3.1.6</b> 更改为其他的主题</a></li>
<li class="chapter" data-level="3.1.7" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#发布自己的网站"><i class="fa fa-check"></i><b>3.1.7</b> 发布自己的网站</a></li>
<li class="chapter" data-level="3.1.8" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#发布到github上"><i class="fa fa-check"></i><b>3.1.8</b> 发布到github上</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#bookdown"><i class="fa fa-check"></i><b>3.2</b> Bookdown</a></li>
<li class="chapter" data-level="3.3" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#presentation"><i class="fa fa-check"></i><b>3.3</b> Presentation</a></li>
<li class="chapter" data-level="3.4" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#pagedown"><i class="fa fa-check"></i><b>3.4</b> Pagedown</a></li>
<li class="chapter" data-level="3.5" data-path="rmarkdown-beyond.html"><a href="rmarkdown-beyond.html#pkgdown"><i class="fa fa-check"></i><b>3.5</b> Pkgdown</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Git和github</a><ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#安装git"><i class="fa fa-check"></i><b>4.1</b> 安装git</a></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#注册github账户"><i class="fa fa-check"></i><b>4.2</b> 注册github账户</a></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#git基础知识"><i class="fa fa-check"></i><b>4.3</b> Git基础知识</a></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#git配制"><i class="fa fa-check"></i><b>4.4</b> Git配制</a><ul>
<li class="chapter" data-level="4.4.1" data-path="git.html"><a href="git.html#安装git之后需要进行一些全局设置比如用户名邮箱."><i class="fa fa-check"></i><b>4.4.1</b> 安装git之后,需要进行一些全局设置,比如用户名邮箱.</a></li>
<li class="chapter" data-level="4.4.2" data-path="git.html"><a href="git.html#生成秘钥"><i class="fa fa-check"></i><b>4.4.2</b> 生成秘钥</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#git基本操作"><i class="fa fa-check"></i><b>4.5</b> Git基本操作</a><ul>
<li class="chapter" data-level="4.5.1" data-path="git.html"><a href="git.html#创建本地git仓库reop"><i class="fa fa-check"></i><b>4.5.1</b> 创建本地git仓库(reop)</a></li>
<li class="chapter" data-level="4.5.2" data-path="git.html"><a href="git.html#将文件添加到版本库"><i class="fa fa-check"></i><b>4.5.2</b> 将文件添加到版本库</a></li>
<li class="chapter" data-level="4.5.3" data-path="git.html"><a href="git.html#查看仓库状态"><i class="fa fa-check"></i><b>4.5.3</b> 查看仓库状态</a></li>
<li class="chapter" data-level="4.5.4" data-path="git.html"><a href="git.html#查看仓库中的具体修改"><i class="fa fa-check"></i><b>4.5.4</b> 查看仓库中的具体修改</a></li>
<li class="chapter" data-level="4.5.5" data-path="git.html"><a href="git.html#查看提交的历史记录"><i class="fa fa-check"></i><b>4.5.5</b> 查看提交的历史记录</a></li>
<li class="chapter" data-level="4.5.6" data-path="git.html"><a href="git.html#版本回退"><i class="fa fa-check"></i><b>4.5.6</b> 版本回退</a></li>
<li class="chapter" data-level="4.5.7" data-path="git.html"><a href="git.html#回到未来某个版本"><i class="fa fa-check"></i><b>4.5.7</b> 回到未来某个版本</a></li>
<li class="chapter" data-level="4.5.8" data-path="git.html"><a href="git.html#撤销修改"><i class="fa fa-check"></i><b>4.5.8</b> 撤销修改</a></li>
<li class="chapter" data-level="4.5.9" data-path="git.html"><a href="git.html#删除文件"><i class="fa fa-check"></i><b>4.5.9</b> 删除文件</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="git.html"><a href="git.html#git的分支管理"><i class="fa fa-check"></i><b>4.6</b> git的分支管理</a><ul>
<li class="chapter" data-level="4.6.1" data-path="git.html"><a href="git.html#查看分支"><i class="fa fa-check"></i><b>4.6.1</b> 查看分支</a></li>
<li class="chapter" data-level="4.6.2" data-path="git.html"><a href="git.html#创建分支"><i class="fa fa-check"></i><b>4.6.2</b> 创建分支</a></li>
<li class="chapter" data-level="4.6.3" data-path="git.html"><a href="git.html#切换分支"><i class="fa fa-check"></i><b>4.6.3</b> 切换分支</a></li>
<li class="chapter" data-level="4.6.4" data-path="git.html"><a href="git.html#switch命令"><i class="fa fa-check"></i><b>4.6.4</b> <code>switch</code>命令</a></li>
<li class="chapter" data-level="4.6.5" data-path="git.html"><a href="git.html#合并分支merge"><i class="fa fa-check"></i><b>4.6.5</b> 合并分支(merge)</a></li>
<li class="chapter" data-level="4.6.6" data-path="git.html"><a href="git.html#删除分支"><i class="fa fa-check"></i><b>4.6.6</b> 删除分支</a></li>
<li class="chapter" data-level="4.6.7" data-path="git.html"><a href="git.html#分支提交冲突"><i class="fa fa-check"></i><b>4.6.7</b> 分支提交冲突</a></li>
<li class="chapter" data-level="4.6.8" data-path="git.html"><a href="git.html#分支策略"><i class="fa fa-check"></i><b>4.6.8</b> 分支策略</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="git.html"><a href="git.html#远程仓库github"><i class="fa fa-check"></i><b>4.7</b> 远程仓库(GitHub)</a><ul>
<li class="chapter" data-level="4.7.1" data-path="git.html"><a href="git.html#添加到远程仓库"><i class="fa fa-check"></i><b>4.7.1</b> 添加到远程仓库</a></li>
<li class="chapter" data-level="4.7.2" data-path="git.html"><a href="git.html#推送到远程仓库"><i class="fa fa-check"></i><b>4.7.2</b> 推送到远程仓库</a></li>
<li class="chapter" data-level="4.7.3" data-path="git.html"><a href="git.html#从远程仓库获取最新内容"><i class="fa fa-check"></i><b>4.7.3</b> 从远程仓库获取最新内容</a></li>
<li class="chapter" data-level="4.7.4" data-path="git.html"><a href="git.html#查看远程仓库信息"><i class="fa fa-check"></i><b>4.7.4</b> 查看远程仓库信息</a></li>
<li class="chapter" data-level="4.7.5" data-path="git.html"><a href="git.html#从远程仓库克隆"><i class="fa fa-check"></i><b>4.7.5</b> 从远程仓库克隆</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="git.html"><a href="git.html#设置忽略文件"><i class="fa fa-check"></i><b>4.8</b> 设置忽略文件</a></li>
<li class="chapter" data-level="4.9" data-path="git.html"><a href="git.html#多人协作"><i class="fa fa-check"></i><b>4.9</b> 多人协作</a><ul>
<li class="chapter" data-level="4.9.1" data-path="git.html"><a href="git.html#创建远程仓库"><i class="fa fa-check"></i><b>4.9.1</b> 创建远程仓库</a></li>
<li class="chapter" data-level="4.9.2" data-path="git.html"><a href="git.html#本地创建分支并推送到远程仓库"><i class="fa fa-check"></i><b>4.9.2</b> 本地创建分支并推送到远程仓库</a></li>
<li class="chapter" data-level="4.9.3" data-path="git.html"><a href="git.html#邀请合作者"><i class="fa fa-check"></i><b>4.9.3</b> 邀请合作者</a></li>
<li class="chapter" data-level="4.9.4" data-path="git.html"><a href="git.html#合作者参与项目"><i class="fa fa-check"></i><b>4.9.4</b> 合作者参与项目</a></li>
<li class="chapter" data-level="4.9.5" data-path="git.html"><a href="git.html#克隆项目"><i class="fa fa-check"></i><b>4.9.5</b> 克隆项目</a></li>
<li class="chapter" data-level="4.9.6" data-path="git.html"><a href="git.html#开始工作"><i class="fa fa-check"></i><b>4.9.6</b> 开始工作</a></li>
<li class="chapter" data-level="4.9.7" data-path="git.html"><a href="git.html#有冲突怎么办"><i class="fa fa-check"></i><b>4.9.7</b> 有冲突怎么办</a></li>
<li class="chapter" data-level="4.9.8" data-path="git.html"><a href="git.html#抓取分支"><i class="fa fa-check"></i><b>4.9.8</b> 抓取分支</a></li>
<li class="chapter" data-level="4.9.9" data-path="git.html"><a href="git.html#多人协作的工作模式"><i class="fa fa-check"></i><b>4.9.9</b> 多人协作的工作模式</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>5</b> ggplot2</a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot2.html"><a href="ggplot2.html#安装-2"><i class="fa fa-check"></i><b>5.1</b> 安装</a></li>
<li class="chapter" data-level="5.2" data-path="ggplot2.html"><a href="ggplot2.html#基础知识"><i class="fa fa-check"></i><b>5.2</b> 基础知识</a><ul>
<li class="chapter" data-level="5.2.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot图像的三个元素"><i class="fa fa-check"></i><b>5.2.1</b> ggplot图像的三个元素</a></li>
<li class="chapter" data-level="5.2.2" data-path="ggplot2.html"><a href="ggplot2.html#颜色性状大小和其他的美学属性aesthetic-attributes"><i class="fa fa-check"></i><b>5.2.2</b> 颜色,性状,大小和其他的美学属性(aesthetic attributes)</a></li>
<li class="chapter" data-level="5.2.3" data-path="ggplot2.html"><a href="ggplot2.html#分面facetting"><i class="fa fa-check"></i><b>5.2.3</b> 分面(Facetting)</a></li>
<li class="chapter" data-level="5.2.4" data-path="ggplot2.html"><a href="ggplot2.html#图形的图层geom"><i class="fa fa-check"></i><b>5.2.4</b> 图形的图层(geom)</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ggplot2.html"><a href="ggplot2.html#单独几何对象individual-geoms"><i class="fa fa-check"></i><b>5.3</b> 单独几何对象(individual geoms)</a><ul>
<li class="chapter" data-level="5.3.1" data-path="ggplot2.html"><a href="ggplot2.html#基础图形"><i class="fa fa-check"></i><b>5.3.1</b> 基础图形</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="network.html"><a href="network.html"><i class="fa fa-check"></i><b>6</b> Network分析总结</a><ul>
<li class="chapter" data-level="6.1" data-path="network.html"><a href="network.html#example-one"><i class="fa fa-check"></i><b>6.1</b> Example one</a></li>
<li class="chapter" data-level="6.2" data-path="network.html"><a href="network.html#example-two"><i class="fa fa-check"></i><b>6.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multiomics.html"><a href="multiomics.html"><i class="fa fa-check"></i><b>7</b> 多组学分析</a><ul>
<li class="chapter" data-level="7.1" data-path="multiomics.html"><a href="multiomics.html#wgcna"><i class="fa fa-check"></i><b>7.1</b> WGCNA</a></li>
<li class="chapter" data-level="7.2" data-path="multiomics.html"><a href="multiomics.html#基础概念"><i class="fa fa-check"></i><b>7.2</b> 基础概念</a><ul>
<li class="chapter" data-level="7.2.1" data-path="multiomics.html"><a href="multiomics.html#无尺度网络scale-free-network"><i class="fa fa-check"></i><b>7.2.1</b> 无尺度网络(scale free network)</a></li>
<li class="chapter" data-level="7.2.2" data-path="multiomics.html"><a href="multiomics.html#模块module和模块特征值"><i class="fa fa-check"></i><b>7.2.2</b> 模块(module)和模块特征值</a></li>
<li class="chapter" data-level="7.2.3" data-path="multiomics.html"><a href="multiomics.html#连通性-connectivity"><i class="fa fa-check"></i><b>7.2.3</b> 连通性 (Connectivity)</a></li>
<li class="chapter" data-level="7.2.4" data-path="multiomics.html"><a href="multiomics.html#hub-gene"><i class="fa fa-check"></i><b>7.2.4</b> Hub gene</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="multiomics.html"><a href="multiomics.html#wgcna-介绍"><i class="fa fa-check"></i><b>7.3</b> WGCNA 介绍</a><ul>
<li class="chapter" data-level="7.3.1" data-path="multiomics.html"><a href="multiomics.html#计算基因的相关性"><i class="fa fa-check"></i><b>7.3.1</b> 计算基因的相关性</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="multiomics.html"><a href="multiomics.html#使用wgcna包进行分析"><i class="fa fa-check"></i><b>7.4</b> 使用WGCNA包进行分析</a><ul>
<li class="chapter" data-level="7.4.1" data-path="multiomics.html"><a href="multiomics.html#data-input-and-cleaning"><i class="fa fa-check"></i><b>7.4.1</b> Data input and cleaning</a></li>
<li class="chapter" data-level="7.4.2" data-path="multiomics.html"><a href="multiomics.html#network-analysis-of-liver-expression-data-in-female-mice"><i class="fa fa-check"></i><b>7.4.2</b> Network analysis of liver expression data in female mice</a></li>
<li class="chapter" data-level="7.4.3" data-path="multiomics.html"><a href="multiomics.html#relating-modules-to-external-information-and-identifying-important"><i class="fa fa-check"></i><b>7.4.3</b> Relating modules to external information and identifying important</a></li>
<li class="chapter" data-level="7.4.4" data-path="multiomics.html"><a href="multiomics.html#对module进行分析"><i class="fa fa-check"></i><b>7.4.4</b> 对module进行分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regularexpression.html"><a href="regularexpression.html"><i class="fa fa-check"></i><b>8</b> 正则表达式</a><ul>
<li class="chapter" data-level="8.1" data-path="regularexpression.html"><a href="regularexpression.html#特殊字符"><i class="fa fa-check"></i><b>8.1</b> 特殊字符</a></li>
<li class="chapter" data-level="8.2" data-path="regularexpression.html"><a href="regularexpression.html#匹配match"><i class="fa fa-check"></i><b>8.2</b> 匹配(match)</a></li>
<li class="chapter" data-level="8.3" data-path="regularexpression.html"><a href="regularexpression.html#替换-alternates"><i class="fa fa-check"></i><b>8.3</b> 替换 (Alternates)</a></li>
<li class="chapter" data-level="8.4" data-path="regularexpression.html"><a href="regularexpression.html#锚点anchors"><i class="fa fa-check"></i><b>8.4</b> 锚点(anchors)</a><ul>
<li class="chapter" data-level="8.4.1" data-path="regularexpression.html"><a href="regularexpression.html#以固定要求开头"><i class="fa fa-check"></i><b>8.4.1</b> 以固定要求开头</a></li>
<li class="chapter" data-level="8.4.2" data-path="regularexpression.html"><a href="regularexpression.html#以固定要求结尾"><i class="fa fa-check"></i><b>8.4.2</b> 以固定要求结尾</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="regularexpression.html"><a href="regularexpression.html#数量quantifiers"><i class="fa fa-check"></i><b>8.5</b> 数量(Quantifiers)</a></li>
<li class="chapter" data-level="8.6" data-path="regularexpression.html"><a href="regularexpression.html#整体匹配-groups"><i class="fa fa-check"></i><b>8.6</b> 整体匹配 (groups)</a></li>
<li class="chapter" data-level="8.7" data-path="regularexpression.html"><a href="regularexpression.html#反义"><i class="fa fa-check"></i><b>8.7</b> 反义</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html"><i class="fa fa-check"></i><b>9</b> <code>Tidyverse</code>用于数据分析stringr</a><ul>
<li class="chapter" data-level="9.1" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#安装-3"><i class="fa fa-check"></i><b>9.1</b> 安装</a></li>
<li class="chapter" data-level="9.2" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#rstudio-addin"><i class="fa fa-check"></i><b>9.2</b> Rstudio Addin</a></li>
<li class="chapter" data-level="9.3" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#pattern-matching"><i class="fa fa-check"></i><b>9.3</b> Pattern matching</a><ul>
<li class="chapter" data-level="9.3.1" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#计算一个文本中符合要求的数目"><i class="fa fa-check"></i><b>9.3.1</b> 计算一个文本中符合要求的数目</a></li>
<li class="chapter" data-level="9.3.2" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#判断一个文本中是否存在一个pattern"><i class="fa fa-check"></i><b>9.3.2</b> 判断一个文本中是否存在一个pattern</a></li>
<li class="chapter" data-level="9.3.3" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#从文本中提取pattern"><i class="fa fa-check"></i><b>9.3.3</b> 从文本中提取pattern</a></li>
<li class="chapter" data-level="9.3.4" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#确定某个pattern在文本中的位置"><i class="fa fa-check"></i><b>9.3.4</b> 确定某个pattern在文本中的位置</a></li>
<li class="chapter" data-level="9.3.5" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#从文本中提取extract匹配到的group"><i class="fa fa-check"></i><b>9.3.5</b> 从文本中提取(extract)匹配到的group</a></li>
<li class="chapter" data-level="9.3.6" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#从文本中去除匹配到的pattern"><i class="fa fa-check"></i><b>9.3.6</b> 从文本中去除匹配到的pattern</a></li>
<li class="chapter" data-level="9.3.7" data-path="tidyverse-stringr.html"><a href="tidyverse-stringr.html#从文本中替换匹配到的pattern"><i class="fa fa-check"></i><b>9.3.7</b> 从文本中替换匹配到的pattern</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="biostatistics.html"><a href="biostatistics.html"><i class="fa fa-check"></i><b>10</b> Modern Statistics for Modern Biology</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://shenxt.info" target="blank">Find me in my blog</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R cookbook from Xiaotao Shen</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multiomics" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> 多组学分析</h1>
<div id="wgcna" class="section level2">
<h2><span class="header-section-number">7.1</span> WGCNA</h2>
<p>使用官方例子进行学习.</p>
<p><a href="https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/" class="uri">https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/</a></p>
</div>
<div id="基础概念" class="section level2">
<h2><span class="header-section-number">7.2</span> 基础概念</h2>
<p>参考这篇文章.</p>
<p><a href="https://www.omicshare.com/class/Public/Upload/video/20170607150629336688.pdf" class="uri">https://www.omicshare.com/class/Public/Upload/video/20170607150629336688.pdf</a></p>
<div id="无尺度网络scale-free-network" class="section level3">
<h3><span class="header-section-number">7.2.1</span> 无尺度网络(scale free network)</h3>
<p>基因符合无尺度分布</p>
<p>无尺度网络是指大部分节点的degree(与其相连的node)非常少,而小部分的node与非常多的节点相连.如果使用数学语言进行描述:假设某个基因(node)的degree为m,统计网络中所有的基因的m值,然后以m值大小对基因进行分类,n为基因连接数为m的基因,那么m和n成反比.</p>
</div>
<div id="模块module和模块特征值" class="section level3">
<h3><span class="header-section-number">7.2.2</span> 模块(module)和模块特征值</h3>
<p>模块是指表达模式相似的一组基因.</p>
<p>模块特征值:将一组基因归为一个模块之后,如果我们想对该模块进行定量化表示,就需要使用一个值来进行表示该模块在所有样品中的表达值.这时候一般是使用该模块中的所有基因进行PCA分析,然后使用PC1(主成分1)来表示.</p>
</div>
<div id="连通性-connectivity" class="section level3">
<h3><span class="header-section-number">7.2.3</span> 连通性 (Connectivity)</h3>
<p>一个基因和其他所有基因的连接程度,一般只在模块内计算,称之为连接度(connectivity)或者degree.对于非权重网络来说,因为edge没有权重,因此有边就是1,没有边就是0,因此degree就是该基因的边的个数.对于权重网络,边是有权重的,因此,每个基因的degree是值所有边的权重之和.</p>
</div>
<div id="hub-gene" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Hub gene</h3>
<p>在一个模块中,degree排名靠前的基因,说明其处于枢纽位置,称之为hug gene.</p>
</div>
</div>
<div id="wgcna-介绍" class="section level2">
<h2><span class="header-section-number">7.3</span> WGCNA 介绍</h2>
<p>全称为<code>weighted gene co-expression network analysis</code>.将研究重点从单个基因转移到模块.计算的两个关键步骤:1)计算基因间的相关性,2)将基因画为模块.</p>
<div id="计算基因的相关性" class="section level3">
<h3><span class="header-section-number">7.3.1</span> 计算基因的相关性</h3>
<ol style="list-style-type: decimal">
<li>计算基因的两两间相关性</li>
</ol>
<p><span class="math display">\[S_{ij} = |cor(x_i,x_j)|\]</span></p>
<p>其中<span class="math inline">\(S_{ij}\)</span>是基因相关性矩阵.</p>
<ol start="2" style="list-style-type: decimal">
<li>无尺度化</li>
</ol>
<p>也就是对原始的相关性矩阵进行变换.构建相邻矩阵.为了知道两个基因表达是否类似,需要设定一个阈值(threshold),只有当基因之间的相关性大于该阈值,才认为他们之间是相似的,比如0.8.否则不相似,因此,相邻矩阵就是描述两个基因之间是否相似的矩阵.如果使用硬阈值,得到的相邻矩阵应该就是0,1矩阵.但是这种办法的缺点就在于怎么确定阈值?</p>
<p>在WGCNA中,使用的是软阈值的办法,软阈值的思路是通过加权函数,将相邻矩阵中的元素连续化:</p>
<p><span class="math display">\[a_{ij} = power(S_{ij}, \beta) = |S_{ij}|^\beta\]</span></p>
<p>在这里使用的是<code>power</code>函数.需要设置soft threshold,这时候需要确定power函数的参数β.如何选择合适的β呢?WGCNA的作者提供了两个标准:</p>
<ol style="list-style-type: decimal">
<li>网络更接近无尺度网络; 2) 尽可能保留连通性信息.</li>
</ol>
<p>β是WGCNA中第一个关键参数,后面在实际例子中进行详解.</p>
<ol start="3" style="list-style-type: decimal">
<li>基因间表达相关性</li>
</ol>
<p>上面我们得到了基因间的相邻矩阵,WGCNA为了更准确的表示两个基因间表达的相似性,还引入了另外一个概念,也就是TOM(Topological Overlap Matrix),拓扑重叠矩阵,她代表的是两个基因间相似性等于直接相关+间接相关.</p>
<p>计算公式如下:</p>
<p><span class="math display">\[TOM_{ij} = \frac{\displaystyle \sum_{u}{a_{iu}a_{uj}+a_{ij}}}{min(k_i,k_j)+1-a_{ij}}\]</span></p>
<p>其中<span class="math inline">\(\displaystyle \sum_{u}{a_{iu}a_{uj}}\)</span>代表基因i和j.</p>
<p><span class="math inline">\(a_{ij}\)</span>代表基因i和基因j的在相邻矩阵中的值.因此,上式中的分子代表的是基因i和j直接联系加上一阶(基因u)基因联系的和.</p>
<p>而<span class="math inline">\(k_i\)</span>代表基因k的degree,也就是基因k和其他所有直接连接的基因的关系之和.</p>
<p>TOM值的取值范围也是0-1.TOM值也就是WGCNA中最后的weight值.</p>
<ol start="4" style="list-style-type: decimal">
<li>聚类</li>
</ol>
<p>得到TOM值之后,也就得到了TOM矩阵.然后利用TOM矩阵,就可以对基因进行聚类了.WGCNA中使用的是层级聚类,聚类结束之后,就可以对分支进行剪切区分.得到module.</p>
<ol start="5" style="list-style-type: decimal">
<li>后续生物学意义挖掘</li>
</ol>
<p>得到模块之后,可以对模块进行生物学意义的挖掘.</p>
</div>
</div>
<div id="使用wgcna包进行分析" class="section level2">
<h2><span class="header-section-number">7.4</span> 使用WGCNA包进行分析</h2>
<div id="data-input-and-cleaning" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Data input and cleaning</h3>
<ol style="list-style-type: decimal">
<li>首先读取数据并清洗</li>
</ol>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">library</span>(WGCNA)</a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb146-3" data-line-number="3">femData &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb146-4" data-line-number="4"><span class="st">  </span><span class="kw">read.csv</span>(<span class="st">&quot;/Users/shenxt/study/WGCNA_test/LiverFemale3600.csv&quot;</span>)</a>
<a class="sourceLine" id="cb146-5" data-line-number="5"><span class="kw">dim</span>(femData)</a></code></pre></div>
<pre><code>## [1] 3600  143</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="kw">colnames</span>(femData) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## [1] &quot;substanceBXH&quot;   &quot;gene_symbol&quot;    &quot;LocusLinkID&quot;    &quot;ProteomeID&quot;     &quot;cytogeneticLoc&quot; &quot;CHROMOSOME&quot;</code></pre>
<p>可以看到该数据行是基因,列是样品.一共3600个基因.</p>
<p>然后将基因的描述列去掉.并且将其转置,得到的matrix行是样品,列是基因.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">data_exp0 &lt;-</a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(femData[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>)]), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb150-3" data-line-number="3"><span class="kw">colnames</span>(data_exp0) =<span class="st"> </span>femData<span class="op">$</span>substanceBXH</a>
<a class="sourceLine" id="cb150-4" data-line-number="4"><span class="kw">rownames</span>(data_exp0) =<span class="st"> </span><span class="kw">colnames</span>(femData)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>)]</a></code></pre></div>
<p>然后需要去除掉数据(表达矩阵)中的outlier基因和样品.使用的是<code>goodSamplesGenes()</code>函数.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">gsg &lt;-<span class="st"> </span><span class="kw">goodSamplesGenes</span>(data_exp0, <span class="dt">verbose =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  Flagging genes and samples with too many missing values...
##   ..step 1</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">gsg<span class="op">$</span>allOK</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>该函数用来检查数据中的基因是否符合要求,返回结果是一个list.如果<code>allOK</code>为TRUE,则代表通过检查,如果不是TRUE,则需要手动去除基因和样品:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span>gsg<span class="op">$</span>allOK){</a>
<a class="sourceLine" id="cb155-2" data-line-number="2">  <span class="co"># Remove the offending genes and samples from the data:</span></a>
<a class="sourceLine" id="cb155-3" data-line-number="3">  data_exp0 &lt;-<span class="st"> </span>data_exp0[gsg<span class="op">$</span>goodSamples, gsg<span class="op">$</span>goodGenes]</a>
<a class="sourceLine" id="cb155-4" data-line-number="4">}</a></code></pre></div>
<p>我们可以使用数据对样品进行聚类,然后观察有哪些明显的outlier samples.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">sampleTree &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(data_exp0), <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>)</a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb156-3" data-line-number="3">  sampleTree,</a>
<a class="sourceLine" id="cb156-4" data-line-number="4">  <span class="dt">main =</span> <span class="st">&quot;Sample clustering to detect outliers&quot;</span>,</a>
<a class="sourceLine" id="cb156-5" data-line-number="5">  <span class="dt">sub =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-6" data-line-number="6">  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-7" data-line-number="7">  <span class="dt">cex.lab =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb156-8" data-line-number="8">  <span class="dt">cex.axis =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb156-9" data-line-number="9">  <span class="dt">cex.main =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb156-10" data-line-number="10">)</a></code></pre></div>
<p><img src="r_cookbook_files/figure-html/unnamed-chunk-47-1.png" width="100%" /></p>
<p>我们可以设定剪枝的阈值,比如我们设置为15,然后使用<code>cutreeStatic()</code>函数对样品进行分类.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="co"># Determine cluster under the line</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2">clust =<span class="st"> </span><span class="kw">cutreeStatic</span>(sampleTree, <span class="dt">cutHeight =</span> <span class="dv">15</span>, <span class="dt">minSize =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb157-3" data-line-number="3"><span class="kw">table</span>(clust)</a></code></pre></div>
<pre><code>## clust
##   0   1 
##   1 134</code></pre>
<p>可以明显的看到一个outlier sample(0).可以手动删除,也可以自动的办法.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="co"># clust 1 contains the samples we want to keep.</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2">keepSamples =<span class="st"> </span><span class="kw">which</span>(clust <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb159-3" data-line-number="3">datExpr =<span class="st"> </span>data_exp0[keepSamples,]</a>
<a class="sourceLine" id="cb159-4" data-line-number="4">nGenes =<span class="st"> </span><span class="kw">ncol</span>(datExpr)</a>
<a class="sourceLine" id="cb159-5" data-line-number="5">nSamples =<span class="st"> </span><span class="kw">nrow</span>(datExpr)</a>
<a class="sourceLine" id="cb159-6" data-line-number="6">nGenes</a></code></pre></div>
<pre><code>## [1] 3600</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1">nSamples</a></code></pre></div>
<pre><code>## [1] 134</code></pre>
<p><code>datExpr</code>就是我们最终用来进行network分析的表达数据.一共3600个基因,134个样品.</p>
<p>下面我们需要读取clinical data.后续需要使用clinical data和模块数据做分析.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">traitData &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;/Users/shenxt/study/WGCNA_test/ClinicalTraits.csv&quot;</span>)</a>
<a class="sourceLine" id="cb163-2" data-line-number="2"><span class="kw">dim</span>(traitData)</a></code></pre></div>
<pre><code>## [1] 361  38</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw">names</span>(traitData)</a></code></pre></div>
<pre><code>##  [1] &quot;X&quot;                  &quot;Mice&quot;               &quot;Number&quot;             &quot;Mouse_ID&quot;           &quot;Strain&quot;            
##  [6] &quot;sex&quot;                &quot;DOB&quot;                &quot;parents&quot;            &quot;Western_Diet&quot;       &quot;Sac_Date&quot;          
## [11] &quot;weight_g&quot;           &quot;length_cm&quot;          &quot;ab_fat&quot;             &quot;other_fat&quot;          &quot;total_fat&quot;         
## [16] &quot;comments&quot;           &quot;X100xfat_weight&quot;    &quot;Trigly&quot;             &quot;Total_Chol&quot;         &quot;HDL_Chol&quot;          
## [21] &quot;UC&quot;                 &quot;FFA&quot;                &quot;Glucose&quot;            &quot;LDL_plus_VLDL&quot;      &quot;MCP_1_phys&quot;        
## [26] &quot;Insulin_ug_l&quot;       &quot;Glucose_Insulin&quot;    &quot;Leptin_pg_ml&quot;       &quot;Adiponectin&quot;        &quot;Aortic.lesions&quot;    
## [31] &quot;Note&quot;               &quot;Aneurysm&quot;           &quot;Aortic_cal_M&quot;       &quot;Aortic_cal_L&quot;       &quot;CoronaryArtery_Cal&quot;
## [36] &quot;Myocardial_cal&quot;     &quot;BMD_all_limbs&quot;      &quot;BMD_femurs_only&quot;</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="co"># remove columns that hold information we do not need.</span></a>
<a class="sourceLine" id="cb167-2" data-line-number="2">allTraits =<span class="st"> </span>traitData[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">31</span>, <span class="dv">16</span>)]</a>
<a class="sourceLine" id="cb167-3" data-line-number="3">allTraits =<span class="st"> </span>allTraits[, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">36</span>)]</a>
<a class="sourceLine" id="cb167-4" data-line-number="4"><span class="kw">dim</span>(allTraits)</a></code></pre></div>
<pre><code>## [1] 361  27</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="kw">names</span>(allTraits)</a></code></pre></div>
<pre><code>##  [1] &quot;Mice&quot;               &quot;weight_g&quot;           &quot;length_cm&quot;          &quot;ab_fat&quot;             &quot;other_fat&quot;         
##  [6] &quot;total_fat&quot;          &quot;X100xfat_weight&quot;    &quot;Trigly&quot;             &quot;Total_Chol&quot;         &quot;HDL_Chol&quot;          
## [11] &quot;UC&quot;                 &quot;FFA&quot;                &quot;Glucose&quot;            &quot;LDL_plus_VLDL&quot;      &quot;MCP_1_phys&quot;        
## [16] &quot;Insulin_ug_l&quot;       &quot;Glucose_Insulin&quot;    &quot;Leptin_pg_ml&quot;       &quot;Adiponectin&quot;        &quot;Aortic.lesions&quot;    
## [21] &quot;Aneurysm&quot;           &quot;Aortic_cal_M&quot;       &quot;Aortic_cal_L&quot;       &quot;CoronaryArtery_Cal&quot; &quot;Myocardial_cal&quot;    
## [26] &quot;BMD_all_limbs&quot;      &quot;BMD_femurs_only&quot;</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="co"># Form a data frame analogous to expression data that will hold the clinical traits.</span></a>
<a class="sourceLine" id="cb171-2" data-line-number="2">femaleSamples =<span class="st"> </span><span class="kw">rownames</span>(datExpr)</a>
<a class="sourceLine" id="cb171-3" data-line-number="3">traitRows =<span class="st"> </span><span class="kw">match</span>(femaleSamples, allTraits<span class="op">$</span>Mice)</a>
<a class="sourceLine" id="cb171-4" data-line-number="4">datTraits =<span class="st"> </span>allTraits[traitRows, <span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb171-5" data-line-number="5"><span class="kw">rownames</span>(datTraits) =<span class="st"> </span>allTraits[traitRows, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb171-6" data-line-number="6"><span class="kw">collectGarbage</span>()</a></code></pre></div>
<p>这时候我们得到的<code>datTraits</code>就是clinicaldata,其中行为样品,列为变量.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">rownames</span>(datTraits) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(datExpr))</a></code></pre></div>
<pre><code>## [1] 134</code></pre>
<p>下面我们来看看样品的临床数据的热图和样品的基因的聚类.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1"><span class="co"># Re-cluster samples</span></a>
<a class="sourceLine" id="cb174-2" data-line-number="2">sampleTree2 &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(datExpr), <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>)</a>
<a class="sourceLine" id="cb174-3" data-line-number="3"><span class="co"># Convert traits to a color representation: white means low, red means high, grey means missing entry</span></a>
<a class="sourceLine" id="cb174-4" data-line-number="4">traitColors =<span class="st"> </span><span class="kw">numbers2colors</span>(datTraits, <span class="dt">signed =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb174-5" data-line-number="5"><span class="co"># Plot the sample dendrogram and the colors underneath.</span></a>
<a class="sourceLine" id="cb174-6" data-line-number="6"><span class="kw">plotDendroAndColors</span>(<span class="dt">dendro =</span> sampleTree2,</a>
<a class="sourceLine" id="cb174-7" data-line-number="7">                    <span class="dt">colors =</span> traitColors,</a>
<a class="sourceLine" id="cb174-8" data-line-number="8">                    <span class="dt">groupLabels =</span> <span class="kw">names</span>(datTraits),</a>
<a class="sourceLine" id="cb174-9" data-line-number="9">                    <span class="dt">main =</span> <span class="st">&quot;Sample dendrogram and trait heatmap&quot;</span>)</a></code></pre></div>
<p><img src="r_cookbook_files/figure-html/unnamed-chunk-52-1.png" width="100%" /></p>
<p>最后,把数据保存下来,准备后续的分析.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="kw">save</span>(datExpr, datTraits, <span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/FemaleLiver-01-dataInput.RData&quot;</span>)</a></code></pre></div>
</div>
<div id="network-analysis-of-liver-expression-data-in-female-mice" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Network analysis of liver expression data in female mice</h3>
<p>数据都准备好之后,下面就是做网络分析和module detection.</p>
<ol style="list-style-type: decimal">
<li>首先需要设置R运行环境,主要是要能够进行多线程处理,然后读取数据:</li>
</ol>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1"><span class="kw">enableWGCNAThreads</span>(<span class="dt">nThreads =</span> <span class="dv">6</span>)</a></code></pre></div>
<pre><code>## Allowing parallel execution with up to 6 working processes.</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="co"># Load the data saved in the first part</span></a>
<a class="sourceLine" id="cb178-2" data-line-number="2">lnames =<span class="st"> </span><span class="kw">load</span>(<span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/FemaleLiver-01-dataInput.RData&quot;</span>)</a>
<a class="sourceLine" id="cb178-3" data-line-number="3"><span class="co">#The variable lnames contains the names of loaded variables.</span></a>
<a class="sourceLine" id="cb178-4" data-line-number="4">lnames</a></code></pre></div>
<pre><code>## [1] &quot;datExpr&quot;   &quot;datTraits&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Automatic network construction and module detection</li>
</ol>
<p>WGCNA的第一个重要参数,就是构建相邻矩阵是的power函数的参数β.首先需要选择合适的<code>soft-thresholding power</code></p>
<p>在WGCNA中,使用<code>pickSoftThreshold()</code>函数.一般需要选择一系列candidate powers,然后根据结果进行选择.</p>
<blockquote>
<p>注意,这段代码在Rstudio中不能运行,运行出错,需要到R自带IDE或者终端中运行.</p>
</blockquote>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="co"># Choose a set of soft-thresholding powers</span></a>
<a class="sourceLine" id="cb180-2" data-line-number="2">powers =<span class="st"> </span><span class="kw">c</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>), <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">12</span>, <span class="dt">to =</span> <span class="dv">20</span>, <span class="dt">by =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb180-3" data-line-number="3"><span class="co"># Call the network topology analysis function</span></a>
<a class="sourceLine" id="cb180-4" data-line-number="4">sft =<span class="st"> </span><span class="kw">pickSoftThreshold</span>(datExpr, <span class="dt">powerVector =</span> powers, <span class="dt">verbose =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb180-5" data-line-number="5"><span class="kw">save</span>(sft, <span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/sft&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1"><span class="kw">load</span>(<span class="st">&quot;/Users/shenxt/study/WGCNA_test/sft&quot;</span>)</a>
<a class="sourceLine" id="cb181-2" data-line-number="2">powers =<span class="st"> </span><span class="kw">c</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>), <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">12</span>, <span class="dt">to =</span> <span class="dv">20</span>, <span class="dt">by =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb181-3" data-line-number="3"><span class="co"># Scale-free topology fit index as a function of the soft-thresholding power</span></a>
<a class="sourceLine" id="cb181-4" data-line-number="4">sft<span class="op">$</span>fitIndices <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb181-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Power, <span class="dt">y =</span> <span class="op">-</span><span class="kw">sign</span>(slope) <span class="op">*</span><span class="st"> </span>SFT.R.sq)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.9</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">16</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-8" data-line-number="8"><span class="st">  </span>ggrepel<span class="op">::</span><span class="kw">geom_text_repel</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Power, <span class="dt">y =</span> <span class="op">-</span><span class="kw">sign</span>(slope) <span class="op">*</span><span class="st"> </span>SFT.R.sq, <span class="dt">label =</span> Power),</a>
<a class="sourceLine" id="cb181-9" data-line-number="9">                           <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Soft Threshold (power)&quot;</span>, </a>
<a class="sourceLine" id="cb181-11" data-line-number="11">       <span class="dt">y =</span> <span class="st">&quot;Scale Free Topology Model Fit,signed R^2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-12" data-line-number="12"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb181-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>), </a>
<a class="sourceLine" id="cb181-14" data-line-number="14">        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">13</span>))</a>
<a class="sourceLine" id="cb181-15" data-line-number="15"><span class="co"># Mean connectivity as a function of the soft-thresholding power</span></a>
<a class="sourceLine" id="cb181-16" data-line-number="16">sft<span class="op">$</span>fitIndices <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb181-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Power, <span class="dt">y =</span> mean.k.)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">16</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-19" data-line-number="19"><span class="st">  </span>ggrepel<span class="op">::</span><span class="kw">geom_text_repel</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Power, <span class="dt">y =</span> mean.k., <span class="dt">label =</span> Power),</a>
<a class="sourceLine" id="cb181-20" data-line-number="20">                           <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-21" data-line-number="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Soft Threshold (power)&quot;</span>, </a>
<a class="sourceLine" id="cb181-22" data-line-number="22">       <span class="dt">y =</span> <span class="st">&quot;Mean Connectivity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-23" data-line-number="23"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb181-24" data-line-number="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>), </a>
<a class="sourceLine" id="cb181-25" data-line-number="25">        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">13</span>))</a></code></pre></div>
<p><img src="r_cookbook_files/figure-html/unnamed-chunk-56-1.png" width="50%" /><img src="r_cookbook_files/figure-html/unnamed-chunk-56-2.png" width="50%" /></p>
<p>左边图显示的是power和scale free topology fit的关系,右图显示的是power和mean connectivity的关系,一般选择能够使scale free topology fit达到最大时的最小的power.</p>
<p>这里我们选择6.</p>
<p>确定了power(β)参数之后,后面使用<code>blockwiseModules()</code>函数就可以得到modules.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">net &lt;-<span class="st"> </span><span class="kw">blockwiseModules</span>(</a>
<a class="sourceLine" id="cb182-2" data-line-number="2">  datExpr,</a>
<a class="sourceLine" id="cb182-3" data-line-number="3">  <span class="dt">power =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb182-4" data-line-number="4">  <span class="dt">TOMType =</span> <span class="st">&quot;unsigned&quot;</span>,</a>
<a class="sourceLine" id="cb182-5" data-line-number="5">  <span class="dt">minModuleSize =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb182-6" data-line-number="6">  <span class="dt">reassignThreshold =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb182-7" data-line-number="7">  <span class="dt">mergeCutHeight =</span> <span class="fl">0.25</span>,</a>
<a class="sourceLine" id="cb182-8" data-line-number="8">  <span class="dt">numericLabels =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb182-9" data-line-number="9">  <span class="dt">pamRespectsDendro =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb182-10" data-line-number="10">  <span class="dt">saveTOMs =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb182-11" data-line-number="11">  <span class="dt">saveTOMFileBase =</span> <span class="st">&quot;femaleMouseTOM&quot;</span>,</a>
<a class="sourceLine" id="cb182-12" data-line-number="12">  <span class="dt">verbose =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb182-13" data-line-number="13">)</a></code></pre></div>
<pre><code>##  Calculating module eigengenes block-wise from all genes
##    Flagging genes and samples with too many missing values...
##     ..step 1
## Cluster size 3600 broken into 2108 1492 
## Cluster size 2108 broken into 1126 982 
## Done cluster 1126 
## Done cluster 982 
## Done cluster 2108 
## Done cluster 1492 
##  ..Working on block 1 .
##     TOM calculation: adjacency..
##     ..will use 6 parallel threads.
##      Fraction of slow calculations: 0.386114
##     ..connectivity..
##     ..matrix multiplication (system BLAS)..
##     ..normalization..
##     ..done.
##    ..saving TOM for block 1 into file femaleMouseTOM-block.1.RData
##  ....clustering..
##  ....detecting modules..
##  ....calculating module eigengenes..
##  ....checking kME in modules..
##      ..removing 1 genes from module 1 because their KME is too low.
##      ..removing 1 genes from module 7 because their KME is too low.
##      ..removing 1 genes from module 8 because their KME is too low.
##      ..removing 1 genes from module 21 because their KME is too low.
##  ..merging modules that are too close..
##      mergeCloseModules: Merging modules whose distance is less than 0.25
##        Calculating new MEs...</code></pre>
<p><code>dataExpr</code>是基因表达数据,行是样品,列基因.</p>
<p>在这里我们选择了soft thresholding power 6, 然后最小module size设置为30.<code>mergeCutHeight</code>用来控制merge module.</p>
<p><code>maxBlockSize</code>: 是指最大的module的基因数量,默认为5000.</p>
<p><code>net</code>是最终的分类结果.</p>
<p>下面看一下分类结果.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="kw">names</span>(net)</a></code></pre></div>
<pre><code>##  [1] &quot;colors&quot;         &quot;unmergedColors&quot; &quot;MEs&quot;            &quot;goodSamples&quot;    &quot;goodGenes&quot;      &quot;dendrograms&quot;    &quot;TOMFiles&quot;      
##  [8] &quot;blockGenes&quot;     &quot;blocks&quot;         &quot;MEsOK&quot;</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1"><span class="kw">table</span>(net<span class="op">$</span>colors)</a></code></pre></div>
<pre><code>## 
##   0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 
##  99 609 460 409 316 312 221 211 157 123 106 100  94  91  77  76  58  47  34</code></pre>
<p>使用颜色来表示module,代表这里面有18个module.标记为0的基因代表没有归为任何一类module.</p>
<p>下面我们把module画出来.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1"><span class="co"># Convert labels to colors for plotting</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2">mergedColors =<span class="st"> </span><span class="kw">labels2colors</span>(net<span class="op">$</span>colors)</a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="co"># Plot the dendrogram and the module colors underneath</span></a>
<a class="sourceLine" id="cb188-4" data-line-number="4"><span class="kw">plotDendroAndColors</span>(</a>
<a class="sourceLine" id="cb188-5" data-line-number="5">  net<span class="op">$</span>dendrograms[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb188-6" data-line-number="6">  mergedColors[net<span class="op">$</span>blockGenes[[<span class="dv">1</span>]]],</a>
<a class="sourceLine" id="cb188-7" data-line-number="7">  <span class="st">&quot;Module colors&quot;</span>,</a>
<a class="sourceLine" id="cb188-8" data-line-number="8">  <span class="dt">dendroLabels =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb188-9" data-line-number="9">  <span class="dt">hang =</span> <span class="fl">0.03</span>,</a>
<a class="sourceLine" id="cb188-10" data-line-number="10">  <span class="dt">addGuide =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb188-11" data-line-number="11">  <span class="dt">guideHang =</span> <span class="fl">0.05</span></a>
<a class="sourceLine" id="cb188-12" data-line-number="12">)</a></code></pre></div>
<p><img src="r_cookbook_files/figure-html/unnamed-chunk-59-1.png" width="100%" /></p>
<p>然后将结果保存,用于后续的分析.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">moduleLabels =<span class="st"> </span>net<span class="op">$</span>colors</a>
<a class="sourceLine" id="cb189-2" data-line-number="2">moduleColors =<span class="st"> </span><span class="kw">labels2colors</span>(net<span class="op">$</span>colors)</a>
<a class="sourceLine" id="cb189-3" data-line-number="3">MEs =<span class="st"> </span>net<span class="op">$</span>MEs</a>
<a class="sourceLine" id="cb189-4" data-line-number="4"></a>
<a class="sourceLine" id="cb189-5" data-line-number="5">geneTree =<span class="st"> </span>net<span class="op">$</span>dendrograms[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb189-6" data-line-number="6"></a>
<a class="sourceLine" id="cb189-7" data-line-number="7"><span class="kw">save</span>(MEs, moduleLabels, moduleColors, geneTree, net,</a>
<a class="sourceLine" id="cb189-8" data-line-number="8">     <span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/FemaleLiver-02-networkConstruction-auto.RData&quot;</span>)</a></code></pre></div>
</div>
<div id="relating-modules-to-external-information-and-identifying-important" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Relating modules to external information and identifying important</h3>
<p>首先加载上一步产生的数据:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">lnames =<span class="st"> </span><span class="kw">load</span>(<span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/FemaleLiver-01-dataInput.RData&quot;</span>);</a>
<a class="sourceLine" id="cb190-2" data-line-number="2"><span class="co">#The variable lnames contains the names of loaded variables.</span></a>
<a class="sourceLine" id="cb190-3" data-line-number="3">lnames</a></code></pre></div>
<pre><code>## [1] &quot;datExpr&quot;   &quot;datTraits&quot;</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1"><span class="co"># Load network data saved in the second part.</span></a>
<a class="sourceLine" id="cb192-2" data-line-number="2">lnames =<span class="st"> </span><span class="kw">load</span>(<span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/FemaleLiver-02-networkConstruction-auto.RData&quot;</span>);</a>
<a class="sourceLine" id="cb192-3" data-line-number="3">lnames</a></code></pre></div>
<pre><code>## [1] &quot;MEs&quot;          &quot;moduleLabels&quot; &quot;moduleColors&quot; &quot;geneTree&quot;     &quot;net&quot;</code></pre>
<p>然后我们想要找到和clinical data关系非常紧密的module.对于每个module的来说,都有一个eigengene,也就是其PCA分析的第一主成分,用来代表该module在每个样品中的含量.</p>
<p>这个矩阵除了可以从最终的结果<code>net</code>中直接得到,还可以使用下面的函数<code>moduleEigengenes</code>得到.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1"><span class="co"># Recalculate MEs with color labels</span></a>
<a class="sourceLine" id="cb194-2" data-line-number="2">MEs0 =<span class="st"> </span><span class="kw">moduleEigengenes</span>(<span class="dt">expr =</span> datExpr, <span class="dt">colors =</span> moduleColors)<span class="op">$</span>eigengenes</a>
<a class="sourceLine" id="cb194-3" data-line-number="3">MEs =<span class="st"> </span><span class="kw">orderMEs</span>(MEs0)</a></code></pre></div>
<p>我们也可以把这个数据和从<code>net</code>中直接得到的对比看一下.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1">test &lt;-<span class="st"> </span>net<span class="op">$</span>MEs</a>
<a class="sourceLine" id="cb195-2" data-line-number="2"><span class="kw">data.frame</span>(<span class="kw">colnames</span>(test), <span class="kw">colnames</span>(MEs), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb195-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb195-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>()</a></code></pre></div>
<pre><code>##    colnames.test.  colnames.MEs.
## 1             ME9      MEmagenta
## 2             ME7        MEblack
## 3             ME1    MEturquoise
## 4             ME5        MEgreen
## 5            ME16    MElightcyan
## 6             ME2         MEblue
## 7             ME3        MEbrown
## 8             ME6          MEred
## 9             ME4       MEsalmon
## 10           ME13       MEyellow
## 11           ME18   MElightgreen
## 12           ME11  MEgreenyellow
## 13           ME17       MEgrey60
## 14            ME8         MEpink
## 15           ME10       MEpurple
## 16           ME12          MEtan
## 17           ME14         MEcyan
## 18           ME15 MEmidnightblue
## 19            ME0         MEgrey</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1"><span class="kw">data.frame</span>(moduleColors, net<span class="op">$</span>colors, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb197-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb197-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>()</a></code></pre></div>
<pre><code>##    moduleColors net.colors
## 1          grey          0
## 2     turquoise          1
## 3        grey60         17
## 4        yellow          4
## 5           tan         12
## 6         green          5
## 7           red          6
## 8         black          7
## 9          blue          2
## 10 midnightblue         15
## 11         cyan         14
## 12      magenta          9
## 13       salmon         13
## 14   lightgreen         18
## 15        brown          3
## 16       purple         10
## 17         pink          8
## 18  greenyellow         11
## 19    lightcyan         16</code></pre>
<p>然后我们使用<code>WGCNA</code>中的<code>cor</code>函数计算module和clinical data的相关性.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1"><span class="co"># Define numbers of genes and samples</span></a>
<a class="sourceLine" id="cb199-2" data-line-number="2">nGenes =<span class="st"> </span><span class="kw">ncol</span>(datExpr)</a>
<a class="sourceLine" id="cb199-3" data-line-number="3">nSamples =<span class="st"> </span><span class="kw">nrow</span>(datExpr)</a>
<a class="sourceLine" id="cb199-4" data-line-number="4">moduleTraitCor =<span class="st"> </span>WGCNA<span class="op">::</span><span class="kw">cor</span>(MEs, datTraits, <span class="dt">use =</span> <span class="st">&quot;p&quot;</span>)</a>
<a class="sourceLine" id="cb199-5" data-line-number="5">moduleTraitPvalue =<span class="st"> </span><span class="kw">corPvalueStudent</span>(moduleTraitCor, nSamples)</a></code></pre></div>
<p>下面对correlation进行可视化:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1"><span class="co"># Will display correlations and their p-values</span></a>
<a class="sourceLine" id="cb200-2" data-line-number="2">textMatrix =<span class="st"> </span><span class="kw">paste</span>(<span class="kw">signif</span>(moduleTraitCor, <span class="dv">2</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">(&quot;</span>,</a>
<a class="sourceLine" id="cb200-3" data-line-number="3"><span class="kw">signif</span>(moduleTraitPvalue, <span class="dv">1</span>), <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb200-4" data-line-number="4"><span class="kw">dim</span>(textMatrix) =<span class="st"> </span><span class="kw">dim</span>(moduleTraitCor)</a>
<a class="sourceLine" id="cb200-5" data-line-number="5"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="fl">8.5</span>, <span class="dv">3</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb200-6" data-line-number="6"><span class="co"># Display the correlation values within a heatmap plot</span></a>
<a class="sourceLine" id="cb200-7" data-line-number="7"><span class="kw">labeledHeatmap</span>(<span class="dt">Matrix =</span> moduleTraitCor,</a>
<a class="sourceLine" id="cb200-8" data-line-number="8"><span class="dt">xLabels =</span> <span class="kw">names</span>(datTraits),</a>
<a class="sourceLine" id="cb200-9" data-line-number="9"><span class="dt">yLabels =</span> <span class="kw">names</span>(MEs),</a>
<a class="sourceLine" id="cb200-10" data-line-number="10"><span class="dt">ySymbols =</span> <span class="kw">names</span>(MEs),</a>
<a class="sourceLine" id="cb200-11" data-line-number="11"><span class="dt">colorLabels =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb200-12" data-line-number="12"><span class="dt">colors =</span> <span class="kw">greenWhiteRed</span>(<span class="dv">50</span>),</a>
<a class="sourceLine" id="cb200-13" data-line-number="13"><span class="co"># textMatrix = textMatrix,</span></a>
<a class="sourceLine" id="cb200-14" data-line-number="14"><span class="dt">setStdMargins =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb200-15" data-line-number="15"><span class="dt">cex.text =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb200-16" data-line-number="16"><span class="dt">zlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb200-17" data-line-number="17"><span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Module-trait relationships&quot;</span>))</a></code></pre></div>
<p><img src="r_cookbook_files/figure-html/unnamed-chunk-65-1.png" width="100%" /></p>
<p>从上图中可以看出<code>weight_g</code>跟一些module相关性非常强.</p>
<p>Gene relationship to trait and important modules: Gene Significance and Module Membership</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1"><span class="co"># Define variable weight containing the weight column of datTrait</span></a>
<a class="sourceLine" id="cb201-2" data-line-number="2">weight =<span class="st"> </span><span class="kw">as.data.frame</span>(datTraits<span class="op">$</span>weight_g)</a>
<a class="sourceLine" id="cb201-3" data-line-number="3"><span class="kw">colnames</span>(weight) =<span class="st"> &quot;weight&quot;</span></a>
<a class="sourceLine" id="cb201-4" data-line-number="4"><span class="co"># names (colors) of the modules</span></a>
<a class="sourceLine" id="cb201-5" data-line-number="5">modNames =<span class="st"> </span><span class="kw">substring</span>(<span class="kw">names</span>(MEs), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb201-6" data-line-number="6"><span class="co">##计算每个基因和module的相关性</span></a>
<a class="sourceLine" id="cb201-7" data-line-number="7">geneModuleMembership =<span class="st"> </span><span class="kw">as.data.frame</span>(WGCNA<span class="op">::</span><span class="kw">cor</span>(datExpr, MEs, <span class="dt">use =</span> <span class="st">&quot;p&quot;</span>))</a>
<a class="sourceLine" id="cb201-8" data-line-number="8">MMPvalue =<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">corPvalueStudent</span>(<span class="kw">as.matrix</span>(geneModuleMembership), nSamples))</a>
<a class="sourceLine" id="cb201-9" data-line-number="9"><span class="kw">names</span>(geneModuleMembership) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;MM&quot;</span>, modNames, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb201-10" data-line-number="10"><span class="kw">names</span>(MMPvalue) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;p.MM&quot;</span>, modNames, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb201-11" data-line-number="11"><span class="co">##计算基因和weight的相关性</span></a>
<a class="sourceLine" id="cb201-12" data-line-number="12">geneTraitSignificance =<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cor</span>(datExpr, weight, <span class="dt">use =</span> <span class="st">&quot;p&quot;</span>))</a>
<a class="sourceLine" id="cb201-13" data-line-number="13">GSPvalue =<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">corPvalueStudent</span>(<span class="kw">as.matrix</span>(geneTraitSignificance), nSamples))</a>
<a class="sourceLine" id="cb201-14" data-line-number="14"></a>
<a class="sourceLine" id="cb201-15" data-line-number="15"><span class="kw">names</span>(geneTraitSignificance) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;GS.&quot;</span>, <span class="kw">names</span>(weight), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb201-16" data-line-number="16"><span class="kw">names</span>(GSPvalue) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;p.GS.&quot;</span>, <span class="kw">names</span>(weight), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>Intramodular analysis: identifying genes with high GS and MM</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">module =<span class="st"> &quot;brown&quot;</span></a>
<a class="sourceLine" id="cb202-2" data-line-number="2">column =<span class="st"> </span><span class="kw">match</span>(module, modNames)</a>
<a class="sourceLine" id="cb202-3" data-line-number="3">moduleGenes =<span class="st"> </span>moduleColors<span class="op">==</span>module</a>
<a class="sourceLine" id="cb202-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb202-5" data-line-number="5"><span class="kw">verboseScatterplot</span>(</a>
<a class="sourceLine" id="cb202-6" data-line-number="6">  <span class="kw">abs</span>(geneModuleMembership[moduleGenes, column]),</a>
<a class="sourceLine" id="cb202-7" data-line-number="7">  <span class="kw">abs</span>(geneTraitSignificance[moduleGenes, <span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb202-8" data-line-number="8">  <span class="dt">xlab =</span> <span class="kw">paste</span>(<span class="st">&quot;Module Membership in&quot;</span>, module, <span class="st">&quot;module&quot;</span>),</a>
<a class="sourceLine" id="cb202-9" data-line-number="9">  <span class="dt">ylab =</span> <span class="st">&quot;Gene significance for body weight&quot;</span>,</a>
<a class="sourceLine" id="cb202-10" data-line-number="10">  <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Module membership vs. gene significance</span><span class="ch">\n</span><span class="st">&quot;</span>),</a>
<a class="sourceLine" id="cb202-11" data-line-number="11">  <span class="dt">cex.main =</span> <span class="fl">1.2</span>,</a>
<a class="sourceLine" id="cb202-12" data-line-number="12">  <span class="dt">cex.lab =</span> <span class="fl">1.2</span>,</a>
<a class="sourceLine" id="cb202-13" data-line-number="13">  <span class="dt">cex.axis =</span> <span class="fl">1.2</span>,</a>
<a class="sourceLine" id="cb202-14" data-line-number="14">  <span class="dt">col =</span> module</a>
<a class="sourceLine" id="cb202-15" data-line-number="15">)</a></code></pre></div>
<p><img src="r_cookbook_files/figure-html/unnamed-chunk-67-1.png" width="100%" /></p>
<p>Summary output of network analysis results</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">names</span>(datExpr))</a></code></pre></div>
<pre><code>## [1] &quot;MMT00000044&quot; &quot;MMT00000046&quot; &quot;MMT00000051&quot; &quot;MMT00000076&quot; &quot;MMT00000080&quot; &quot;MMT00000102&quot;</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">names</span>(datExpr)[moduleColors<span class="op">==</span><span class="st">&quot;brown&quot;</span>])</a></code></pre></div>
<pre><code>## [1] &quot;MMT00000887&quot; &quot;MMT00001077&quot; &quot;MMT00001185&quot; &quot;MMT00001486&quot; &quot;MMT00002002&quot; &quot;MMT00002037&quot;</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">annot &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb207-2" data-line-number="2"><span class="st">  </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/GeneAnnotation.csv&quot;</span>)</a>
<a class="sourceLine" id="cb207-3" data-line-number="3"><span class="kw">dim</span>(annot)</a></code></pre></div>
<pre><code>## [1] 23388    34</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1"><span class="kw">names</span>(annot)</a></code></pre></div>
<pre><code>##  [1] &quot;X&quot;                        &quot;ID&quot;                       &quot;arrayname&quot;                &quot;substanceBXH&quot;            
##  [5] &quot;gene_symbol&quot;              &quot;LocusLinkID&quot;              &quot;OfficialGeneSymbol&quot;       &quot;OfficialGeneName&quot;        
##  [9] &quot;LocusLinkSymbol&quot;          &quot;LocusLinkName&quot;            &quot;ProteomeShortDescription&quot; &quot;UnigeneCluster&quot;          
## [13] &quot;LocusLinkCode&quot;            &quot;ProteomeID&quot;               &quot;ProteomeCode&quot;             &quot;SwissprotID&quot;             
## [17] &quot;OMIMCode&quot;                 &quot;DirectedTilingPriority&quot;   &quot;AlternateSymbols&quot;         &quot;AlternateNames&quot;          
## [21] &quot;SpeciesID&quot;                &quot;cytogeneticLoc&quot;           &quot;Organism&quot;                 &quot;clustername&quot;             
## [25] &quot;reporterid&quot;               &quot;probeid&quot;                  &quot;sequenceid&quot;               &quot;clusterid&quot;               
## [29] &quot;chromosome&quot;               &quot;startcoordinate&quot;          &quot;endcoordinate&quot;            &quot;strand&quot;                  
## [33] &quot;sequence_3_to_5_prime&quot;    &quot;sequence_5_to_3_prime&quot;</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1">probes =<span class="st"> </span><span class="kw">names</span>(datExpr)</a>
<a class="sourceLine" id="cb211-2" data-line-number="2">probes2annot =<span class="st"> </span><span class="kw">match</span>(probes, annot<span class="op">$</span>substanceBXH)</a>
<a class="sourceLine" id="cb211-3" data-line-number="3"><span class="co"># The following is the number or probes without annotation:</span></a>
<a class="sourceLine" id="cb211-4" data-line-number="4"><span class="kw">sum</span>(<span class="kw">is.na</span>(probes2annot))</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1"><span class="co"># Create the starting data frame</span></a>
<a class="sourceLine" id="cb213-2" data-line-number="2">geneInfo0 =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">substanceBXH =</span> probes,</a>
<a class="sourceLine" id="cb213-3" data-line-number="3"><span class="dt">geneSymbol =</span> annot<span class="op">$</span>gene_symbol[probes2annot],</a>
<a class="sourceLine" id="cb213-4" data-line-number="4"><span class="dt">LocusLinkID =</span> annot<span class="op">$</span>LocusLinkID[probes2annot],</a>
<a class="sourceLine" id="cb213-5" data-line-number="5"><span class="dt">moduleColor =</span> moduleColors,</a>
<a class="sourceLine" id="cb213-6" data-line-number="6">geneTraitSignificance,</a>
<a class="sourceLine" id="cb213-7" data-line-number="7">GSPvalue)</a>
<a class="sourceLine" id="cb213-8" data-line-number="8"><span class="co"># Order modules by their significance for weight</span></a>
<a class="sourceLine" id="cb213-9" data-line-number="9">modOrder =<span class="st"> </span><span class="kw">order</span>(<span class="op">-</span><span class="kw">abs</span>(<span class="kw">cor</span>(MEs, weight, <span class="dt">use =</span> <span class="st">&quot;p&quot;</span>)));</a>
<a class="sourceLine" id="cb213-10" data-line-number="10"><span class="co"># Add module membership information in the chosen order</span></a>
<a class="sourceLine" id="cb213-11" data-line-number="11"><span class="cf">for</span> (mod <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(geneModuleMembership))</a>
<a class="sourceLine" id="cb213-12" data-line-number="12">{</a>
<a class="sourceLine" id="cb213-13" data-line-number="13">oldNames =<span class="st"> </span><span class="kw">names</span>(geneInfo0)</a>
<a class="sourceLine" id="cb213-14" data-line-number="14">geneInfo0 =<span class="st"> </span><span class="kw">data.frame</span>(geneInfo0, geneModuleMembership[, modOrder[mod]],</a>
<a class="sourceLine" id="cb213-15" data-line-number="15">MMPvalue[, modOrder[mod]]);</a>
<a class="sourceLine" id="cb213-16" data-line-number="16"><span class="kw">names</span>(geneInfo0) =<span class="st"> </span><span class="kw">c</span>(oldNames, <span class="kw">paste</span>(<span class="st">&quot;MM.&quot;</span>, modNames[modOrder[mod]], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>),</a>
<a class="sourceLine" id="cb213-17" data-line-number="17"><span class="kw">paste</span>(<span class="st">&quot;p.MM.&quot;</span>, modNames[modOrder[mod]], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb213-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb213-19" data-line-number="19"><span class="co"># Order the genes in the geneInfo variable first by module color, then by geneTraitSignificance</span></a>
<a class="sourceLine" id="cb213-20" data-line-number="20">geneOrder =<span class="st"> </span><span class="kw">order</span>(geneInfo0<span class="op">$</span>moduleColor, <span class="op">-</span><span class="kw">abs</span>(geneInfo0<span class="op">$</span>GS.weight));</a>
<a class="sourceLine" id="cb213-21" data-line-number="21">geneInfo =<span class="st"> </span>geneInfo0[geneOrder, ]</a>
<a class="sourceLine" id="cb213-22" data-line-number="22"><span class="kw">write.csv</span>(geneInfo, <span class="dt">file =</span> <span class="st">&quot;/Users/shenxt/study/WGCNA_test/geneInfo.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="对module进行分析" class="section level3">
<h3><span class="header-section-number">7.4.4</span> 对module进行分析</h3>
<p>在前文中,鉴定出了几个和weight相关的module.</p>
<p>一般需要进行GO注释或者KEGG pathway分析.</p>
<hr />
<div id="disqus_thread">

</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://r-cookbook-shen.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="network.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regularexpression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r_cookbook.pdf", "r_cookbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
