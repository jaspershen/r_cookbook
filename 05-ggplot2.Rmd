```{r, include = FALSE}
knitr::opts_chunk$set(out.width = "100%")
```

# ggplot2 {#ggplot2}

## 安装

```{r, eval=FALSE,echo=TRUE, cache=TRUE}
install.packages("ggplot2")
```

## 基础知识

### ggplot图像的三个元素

每个`ggplot`都有三个元素组成:

* 数据(data)

在`ggplot2`中,数据一般是data frame(数据框).

* 一系列的美学映射(aesthetic mappings),将数据的变量和可视化的特征联系起来.

aesthetic mappings,直译为美学映射.也就是将数据的变量使用哪种图形属性进行表示.比如最为简单的一副散点图,我们可以使用x轴来表示身高,使用y轴表示体重,然后使用每个点的颜色代表性别.

* 至少一个图层(layer)用来描述变量如何展示,也就是几何对象(geometric).图层一般使用前缀为`geom_`的函数进行创建.

一个简单的例子:

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE}
ggplot(mpg, aes(x = displ, y = hwy)) + 
  geom_point()
```

这幅图中:

1. 数据为`mpg`

2. 美学映射:`displ`映射到x轴,`hwy`映射到y轴.

3. 图层:点图.

`aes()`函数的前两个参数默认是`x`和`y`.

### 颜色,性状,大小和其他的美学属性(aesthetic attributes)

为了在一幅图中将=映射更多的变量,我们可以使用一些其他的美学属性(aesthetic attributes).比如,颜色,性状还有大小.

比如,将颜色映射到变量`class`上:

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE}
ggplot(mpg, aes(displ, cty, colour = class)) + 
  geom_point()
```

如果想要将某个美学属性设置为固定值,应当在`aes`函数之外进行设置:

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,out.width="50%",fig.show='hold'}
ggplot(mpg, aes(displ, hwy)) + geom_point(aes(colour = "blue"))
ggplot(mpg, aes(displ, hwy)) + geom_point(colour = "blue")
```

可以看一下这两幅图的差异.

### 分面(Facetting)

分面也是一种展示分类变量的方法.

`ggplot2`中有两种分面方式:`grid`和`wrapped`.其中`wrapped`.其中wrapped更为重要.需要使用`facet_wrap()`函数.

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,fig.show='hold'}
ggplot(mpg, aes(displ, hwy)) + 
  geom_point() + 
  facet_wrap(~class)
```

### 图形的图层(geom)

图层(geom)就是用来决定变量如何展示在图像上的办法.比如最常见的最简单的点图的图层就是`geom_point()`.

* `geom_smooth`: 对数据进行拟合.

* `geom_boxplot`:箱形图.

* `geom_histogram`:对连续变量分布进行描述.

* `geom_bar`:barplot.

1. 在图中添加smooth曲线

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,fig.show='hold'}
ggplot(mpg, aes(displ, hwy)) + 
  geom_point() + 
  geom_smooth()
```


## 单独几何对象(individual geoms)

### 基础图形

如何理解几何对象?可以理解为图形的表现方式.我们平时所说的散点图(scatter plot),箱形图(box plot)或者柱状图(bar plot)其实就是指的不同的几何对象表现方式.

基础的几何对象都是二维的并且需要`x`和`y`轴美学映射.他们也都能够使用颜色(color)和形状(shape)对变量进行映射.

* `geom_area()`: 该几何对象用来绘制面积图.线条下面使用颜色进行填充.

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,fig.show='hold'}
df <- data.frame(
  x = c(3, 1, 5), 
  y = c(2, 4, 6), 
  label = c("a","b","c")
)
p <- ggplot(df, aes(x, y, label = label)) + 
  labs(x = NULL, y = NULL) + # Hide axis label
  theme(plot.title = element_text(size = 12)) # Shrink plot title
```

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,fig.show='hold'}
p + geom_area() + ggtitle("area")
```

* `geom_bar(stat = "identity")`: 绘制bar plot.注意我们需要将其中的参数`stat`设置为`identify`,因此默认情况下,其会统计x轴变量的个数作为y轴.

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,fig.show='hold'}
p + geom_bar(stat = 'identity') + ggtitle("bar")
```

* `geom_line()`: 绘制线形图.将点按照从左到右顺序进行连接.`geom_path()`函数与`geom_line()`类似,但是连接线的方式是按照他在数据中的顺序进行连接.

```{r, eval=TRUE,echo=TRUE, cache=TRUE,warning=FALSE,fig.show='hold'}
p + geom_line() + ggtitle("line")
p + geom_path() + ggtitle("path")
```

---

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://r-cookbook-shen.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
